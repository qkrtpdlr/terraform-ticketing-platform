# ğŸ« Terraformì„ ì´ìš©í•œ ê³ ê°€ìš©ì„± í‹°ì¼“íŒ… í”„ë¡œì íŠ¸ - ì™„ì „ ì‹¤í–‰ ê°€ì´ë“œ

> **ì‘ì„±ì**: qkrtpdlr
> **í”„ë¡œì íŠ¸**: ê³ ê°€ìš©ì„± í‹°ì¼“íŒ… í”Œë«í¼ (Terraform + Spring Boot + AWS)  
> **ëª©í‘œ**: AWSì—ì„œ ì²˜ìŒë¶€í„° ëê¹Œì§€ í”„ë¡œì íŠ¸ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë°°í¬

---

## ğŸ“‹ ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#1-í”„ë¡œì íŠ¸-ê°œìš”)
2. [ì‚¬ì „ ì¤€ë¹„ì‚¬í•­](#2-ì‚¬ì „-ì¤€ë¹„ì‚¬í•­)
3. [ì „ì²´ ì‹¤í–‰ ìˆœì„œë„](#3-ì „ì²´-ì‹¤í–‰-ìˆœì„œë„)
4. [ë‹¨ê³„ë³„ ìƒì„¸ ê°€ì´ë“œ](#4-ë‹¨ê³„ë³„-ìƒì„¸-ê°€ì´ë“œ)
5. [í…ŒìŠ¤íŠ¸ ë° ê²€ì¦](#5-í…ŒìŠ¤íŠ¸-ë°-ê²€ì¦)
6. [ëª¨ë‹ˆí„°ë§ ì„¤ì •](#6-ëª¨ë‹ˆí„°ë§-ì„¤ì •)
7. [ë¬¸ì œ í•´ê²° (Troubleshooting)](#7-ë¬¸ì œ-í•´ê²°)
8. [í”„ë¡œì íŠ¸ ì‚­ì œ](#8-í”„ë¡œì íŠ¸-ì‚­ì œ)

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 ì•„í‚¤í…ì²˜ êµ¬ì„±
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Internet Gateway                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Application Load Balancer                  â”‚
â”‚              (ê³ ê°€ìš©ì„± ë¡œë“œ ë°¸ëŸ°ì‹±)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   AZ-2a     â”‚           â”‚    AZ-2c    â”‚
    â”‚ Auto Scalingâ”‚           â”‚Auto Scaling â”‚
    â”‚  (2-20ëŒ€)   â”‚           â”‚  (2-20ëŒ€)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                         â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                    â”‚         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”   â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚RDS Aurora  â”‚   â”‚ElastiCache  â”‚
         â”‚(Writer+R/R)â”‚   â”‚   Redis     â”‚
         â”‚  Multi-AZ  â”‚   â”‚  Cluster    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 í•µì‹¬ ê¸°ëŠ¥
- âœ… **ê³ ê°€ìš©ì„±**: Multi-AZ êµ¬ì„±ìœ¼ë¡œ 99.9% ê°€ìš©ì„± ë³´ì¥
- âœ… **ìë™ í™•ì¥**: íŠ¸ë˜í”½ì— ë”°ë¼ 2~20ëŒ€ ìë™ ìŠ¤ì¼€ì¼ë§
- âœ… **ë™ì‹œì„± ì œì–´**: Redis ë¶„ì‚° ë½ìœ¼ë¡œ í‹°ì¼“ ì¤‘ë³µ ì˜ˆë§¤ ë°©ì§€
- âœ… **ìºì‹±**: Redis ìºì‹œë¡œ DB ë¶€í•˜ 90% ê°ì†Œ
- âœ… **ëª¨ë‹ˆí„°ë§**: CloudWatch + SNS ì•ŒëŒìœ¼ë¡œ ì‹¤ì‹œê°„ ê°ì‹œ

### 1.3 ì˜ˆìƒ ë¹„ìš©
- **Dev í™˜ê²½**: ì›” ì•½ $365
- **Production**: ì›” ì•½ $1,200~$2,500 (íŠ¸ë˜í”½ì— ë”°ë¼ ë³€ë™)

---

## 2. ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

### 2.1 í•„ìˆ˜ ì†Œí”„íŠ¸ì›¨ì–´ ì„¤ì¹˜

#### âœ… AWS CLI ì„¤ì¹˜ ë° ì„¤ì •
```bash
# macOS
brew install awscli

# Windows (PowerShell)
msiexec.exe /i https://awscli.amazonaws.com/AWSCLIV2.msi

# Linux
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install

# ì„¤ì¹˜ í™•ì¸
aws --version
# ì¶œë ¥ ì˜ˆì‹œ: aws-cli/2.13.0 Python/3.11.4
```

#### âœ… AWS ìê²© ì¦ëª… ì„¤ì •
```bash
aws configure
# AWS Access Key ID [None]: AKIA************
# AWS Secret Access Key [None]: ****************************
# Default region name [None]: ap-northeast-2
# Default output format [None]: json

# ì„¤ì • í™•ì¸
aws sts get-caller-identity
```

#### âœ… Terraform ì„¤ì¹˜
```bash
# macOS
brew tap hashicorp/tap
brew install hashicorp/tap/terraform

# Windows (Chocolatey)
choco install terraform

# Linux
wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg
echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list
sudo apt update && sudo apt install terraform

# ì„¤ì¹˜ í™•ì¸
terraform --version
# ì¶œë ¥ ì˜ˆì‹œ: Terraform v1.6.0
```

#### âœ… Docker ì„¤ì¹˜
```bash
# macOS
brew install --cask docker

# Windows: Docker Desktop ë‹¤ìš´ë¡œë“œ
# https://www.docker.com/products/docker-desktop

# Linux (Ubuntu)
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# ì„¤ì¹˜ í™•ì¸
docker --version
docker-compose --version
```

#### âœ… Git ì„¤ì¹˜
```bash
# macOS
brew install git

# Windows
winget install --id Git.Git -e --source winget

# Linux
sudo apt install git

# ì„¤ì¹˜ í™•ì¸
git --version
```

#### âœ… Java JDK 17 ì„¤ì¹˜ (ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œìš©)
```bash
# macOS
brew install openjdk@17

# Linux
sudo apt install openjdk-17-jdk

# Windows: Oracle JDK ë‹¤ìš´ë¡œë“œ
# https://www.oracle.com/java/technologies/downloads/#java17

# ì„¤ì¹˜ í™•ì¸
java -version
# ì¶œë ¥ ì˜ˆì‹œ: openjdk version "17.0.8"
```

#### âœ… Maven ì„¤ì¹˜ (ì„ íƒì‚¬í•­ - Docker ë¹Œë“œ ì‹œ ìë™ ì„¤ì¹˜)
```bash
# macOS
brew install maven

# Linux
sudo apt install maven

# ì„¤ì¹˜ í™•ì¸
mvn -version
```

### 2.2 AWS ê³„ì • ì¤€ë¹„ì‚¬í•­

#### âœ… í•„ìˆ˜ ê¶Œí•œ í™•ì¸
ë‹¤ìŒ AWS ì„œë¹„ìŠ¤ì— ëŒ€í•œ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤:
- âœ… VPC (ë„¤íŠ¸ì›Œí¬ ìƒì„±)
- âœ… EC2 (ì¸ìŠ¤í„´ìŠ¤, ë³´ì•ˆ ê·¸ë£¹)
- âœ… RDS (Aurora MySQL)
- âœ… ElastiCache (Redis)
- âœ… ELB (Application Load Balancer)
- âœ… Auto Scaling
- âœ… S3 (ë°±ì—… ìŠ¤í† ë¦¬ì§€)
- âœ… SQS & SNS (ë©”ì‹œì§•)
- âœ… CloudWatch (ëª¨ë‹ˆí„°ë§)
- âœ… ECR (Docker ì´ë¯¸ì§€ ì €ì¥ì†Œ)
- âœ… IAM (ì—­í•  ë° ì •ì±…)

#### âœ… ì„œë¹„ìŠ¤ í•œë„ í™•ì¸
```bash
# EC2 ì¸ìŠ¤í„´ìŠ¤ í•œë„ í™•ì¸
aws service-quotas get-service-quota \
  --service-code ec2 \
  --quota-code L-1216C47A

# í•œë„ê°€ ë¶€ì¡±í•˜ë©´ AWS Consoleì—ì„œ ì¦ê°€ ìš”ì²­
# AWS Console > Service Quotas > EC2 > Running On-Demand Instances
```

#### âœ… í‚¤ í˜ì–´ ìƒì„±
```bash
# EC2 í‚¤ í˜ì–´ ìƒì„± (ì„ íƒì‚¬í•­ - Terraformì´ ìë™ ìƒì„± ê°€ëŠ¥)
aws ec2 create-key-pair \
  --key-name ticketing-keypair \
  --query 'KeyMaterial' \
  --output text > ~/.ssh/ticketing-keypair.pem

chmod 400 ~/.ssh/ticketing-keypair.pem
```

### 2.3 í”„ë¡œì íŠ¸ íŒŒì¼ ì¤€ë¹„

#### âœ… AI Driveì—ì„œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
```bash
# ì‘ì—… ë””ë ‰í† ë¦¬ ìƒì„±
mkdir -p ~/projects/ticketing-platform
cd ~/projects/ticketing-platform

# AI Driveì—ì„œ ì••ì¶• íŒŒì¼ ë‹¤ìš´ë¡œë“œ
# ê²½ë¡œ: /Terraformì„ ì´ìš©í•œ ê³ ê°€ìš©ì„± í‹°ì¼“íŒ… í”„ë¡œì íŠ¸/
# - terraform-ticketing-platform.tar.gz
# - ticketing-app.tar.gz

# ì••ì¶• í•´ì œ
tar -xzf terraform-ticketing-platform.tar.gz
tar -xzf ticketing-app.tar.gz

# ë””ë ‰í† ë¦¬ êµ¬ì¡° í™•ì¸
ls -la
# terraform-ticketing/
# ticketing-app/
```

---

## 3. ì „ì²´ ì‹¤í–‰ ìˆœì„œë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              í”„ë¡œì íŠ¸ ì‹¤í–‰ ìˆœì„œ (ì´ ì†Œìš”ì‹œê°„: ì•½ 40ë¶„)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ í™˜ê²½ ì„¤ì • (5ë¶„)
   â””â”€> AWS CLI ì¸ì¦, Terraform ì´ˆê¸°í™”

2ï¸âƒ£ Terraform ì¸í”„ë¼ ë°°í¬ (15-20ë¶„)
   â””â”€> VPC â†’ Security Groups â†’ RDS â†’ Redis â†’ ALB â†’ Auto Scaling

3ï¸âƒ£ Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ (5ë¶„)
   â””â”€> Maven ë¹Œë“œ â†’ Docker ì´ë¯¸ì§€ ìƒì„±

4ï¸âƒ£ ECRì— ì´ë¯¸ì§€ í‘¸ì‹œ (3ë¶„)
   â””â”€> Docker ì´ë¯¸ì§€ë¥¼ AWS ECRì— ì—…ë¡œë“œ

5ï¸âƒ£ EC2 ì¸ìŠ¤í„´ìŠ¤ì— ë°°í¬ (7ë¶„)
   â””â”€> User Data ìŠ¤í¬ë¦½íŠ¸ë¡œ ìë™ ë°°í¬

6ï¸âƒ£ í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ (5ë¶„)
   â””â”€> API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸, ë™ì‹œì„± í…ŒìŠ¤íŠ¸

7ï¸âƒ£ ëª¨ë‹ˆí„°ë§ ì„¤ì • í™•ì¸ (3ë¶„)
   â””â”€> CloudWatch ëŒ€ì‹œë³´ë“œ, SNS ì•ŒëŒ

8ï¸âƒ£ (ì„ íƒ) ë¶€í•˜ í…ŒìŠ¤íŠ¸ (10ë¶„)
   â””â”€> Locustë¡œ ì„±ëŠ¥ ê²€ì¦

9ï¸âƒ£ í”„ë¡œì íŠ¸ ì‚­ì œ (ì„ íƒ, 5ë¶„)
   â””â”€> terraform destroyë¡œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ ì œê±°
```

---

## 4. ë‹¨ê³„ë³„ ìƒì„¸ ê°€ì´ë“œ

### 4.1 STEP 1: í™˜ê²½ ì„¤ì • (5ë¶„)

#### 1-1. Terraform í”„ë¡œì íŠ¸ ì´ˆê¸°í™”
```bash
cd terraform-ticketing

# Terraform ë³€ìˆ˜ íŒŒì¼ ìƒì„±
cp terraform.tfvars.example terraform.tfvars

# ë³€ìˆ˜ íŒŒì¼ í¸ì§‘ (í•„ìˆ˜)
nano terraform.tfvars
# ë˜ëŠ”
vim terraform.tfvars
```

#### 1-2. terraform.tfvars ì„¤ì •
```hcl
# terraform.tfvars
project_name = "ticketing"
environment  = "dev"
region       = "ap-northeast-2"

# VPC CIDR
vpc_cidr = "10.0.0.0/16"

# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
db_master_username = "admin"
db_master_password = "YourSecurePassword123!"  # ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½!

# Auto Scaling ì„¤ì •
min_size     = 2
max_size     = 20
desired_size = 2

# ì•ŒëŒ ì´ë©”ì¼ (ë³¸ì¸ ì´ë©”ì¼ë¡œ ë³€ê²½)
alarm_email = "your-email@example.com"

# íƒœê·¸
tags = {
  Project     = "Ticketing Platform"
  Owner       = "ë°•ì„¸ìµ"
  Environment = "Development"
  ManagedBy   = "Terraform"
}
```

#### 1-3. Terraform ì´ˆê¸°í™”
```bash
# Provider í”ŒëŸ¬ê·¸ì¸ ë‹¤ìš´ë¡œë“œ
terraform init

# ì¶œë ¥ ì˜ˆì‹œ:
# Initializing the backend...
# Initializing provider plugins...
# - Finding hashicorp/aws versions matching "~> 5.0"...
# Terraform has been successfully initialized!

# ë¬¸ë²• ê²€ì¦
terraform validate

# ì¶œë ¥ ì˜ˆì‹œ:
# Success! The configuration is valid.

# í¬ë§·íŒ… (ì„ íƒ)
terraform fmt -recursive
```

---

### 4.2 STEP 2: Terraform ì¸í”„ë¼ ë°°í¬ (15-20ë¶„)

#### 2-1. ë°°í¬ ê³„íš í™•ì¸
```bash
# ì–´ë–¤ ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë ì§€ ë¯¸ë¦¬ë³´ê¸°
terraform plan

# ì¶œë ¥ ì˜ˆì‹œ:
# Plan: 45 to add, 0 to change, 0 to destroy.
#
# Changes to Outputs:
#   + alb_dns_name     = (known after apply)
#   + db_endpoint      = (known after apply)
#   + redis_endpoint   = (known after apply)
```

#### 2-2. ì¸í”„ë¼ ë°°í¬ ì‹¤í–‰
```bash
# ë°©ë²• 1: ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš© (ê¶Œì¥)
chmod +x scripts/deploy.sh
./scripts/deploy.sh

# ë°©ë²• 2: ìˆ˜ë™ ì‹¤í–‰
terraform apply

# í™•ì¸ ë©”ì‹œì§€ì—ì„œ "yes" ì…ë ¥
# Do you want to perform these actions? yes

# ë°°í¬ ì§„í–‰ ì¤‘... (ì•½ 15-20ë¶„ ì†Œìš”)
# â±ï¸ ì£¼ìš” ë‹¨ê³„ë³„ ì†Œìš” ì‹œê°„:
# - VPC & Subnets: 2ë¶„
# - Security Groups: 1ë¶„
# - RDS Aurora: 10-12ë¶„ (ê°€ì¥ ì˜¤ë˜ ê±¸ë¦¼)
# - ElastiCache Redis: 5-7ë¶„
# - ALB: 2ë¶„
# - Auto Scaling: 3ë¶„
```

#### 2-3. ë°°í¬ ê²°ê³¼ í™•ì¸
```bash
# ì¶œë ¥ê°’ í™•ì¸
terraform output

# ì¶œë ¥ ì˜ˆì‹œ:
# alb_dns_name = "ticketing-dev-alb-1234567890.ap-northeast-2.elb.amazonaws.com"
# db_endpoint = "ticketing-dev-aurora-cluster.cluster-xyz.ap-northeast-2.rds.amazonaws.com:3306"
# redis_endpoint = "ticketing-dev-redis.abc123.ng.0001.apse2.cache.amazonaws.com:6379"
# ecr_repository_url = "123456789012.dkr.ecr.ap-northeast-2.amazonaws.com/ticketing-dev"

# ì¤‘ìš”í•œ ê°’ë“¤ì„ ë³„ë„ë¡œ ì €ì¥
terraform output -raw alb_dns_name > ../alb_dns.txt
terraform output -raw ecr_repository_url > ../ecr_url.txt
terraform output -raw db_endpoint > ../db_endpoint.txt
terraform output -raw redis_endpoint > ../redis_endpoint.txt
```

#### 2-4. AWS Consoleì—ì„œ í™•ì¸
1. **VPC**: https://console.aws.amazon.com/vpc/
   - VPC, Subnets (Public x2, Private x2, Database x2) í™•ì¸
   
2. **RDS**: https://console.aws.amazon.com/rds/
   - Aurora Cluster (Writer + Reader) ìƒíƒœ í™•ì¸
   
3. **ElastiCache**: https://console.aws.amazon.com/elasticache/
   - Redis Cluster ìƒíƒœ í™•ì¸
   
4. **EC2 Load Balancers**: https://console.aws.amazon.com/ec2/v2/home#LoadBalancers
   - ALB ìƒíƒœ "active" í™•ì¸
   
5. **Auto Scaling Groups**: https://console.aws.amazon.com/ec2autoscaling/
   - Desired: 2, Running: 2 í™•ì¸

---

### 4.3 STEP 3: Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ (5ë¶„)

#### 3-1. ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • í™•ì¸
```bash
cd ../ticketing-app

# application.yml í™•ì¸
cat src/main/resources/application.yml
```

#### 3-2. ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • ì—…ë°ì´íŠ¸
```yaml
# src/main/resources/application.yml
spring:
  application:
    name: ticketing-service
  
  datasource:
    # Terraform outputì—ì„œ ê°€ì ¸ì˜¨ RDS ì—”ë“œí¬ì¸íŠ¸ë¡œ ë³€ê²½
    url: jdbc:mysql://ticketing-dev-aurora-cluster.cluster-xyz.ap-northeast-2.rds.amazonaws.com:3306/ticketing?createDatabaseIfNotExist=true
    username: admin
    password: YourSecurePassword123!  # terraform.tfvarsì™€ ë™ì¼
    driver-class-name: com.mysql.cj.jdbc.Driver
  
  redis:
    # Terraform outputì—ì„œ ê°€ì ¸ì˜¨ Redis ì—”ë“œí¬ì¸íŠ¸ë¡œ ë³€ê²½
    host: ticketing-dev-redis.abc123.ng.0001.apse2.cache.amazonaws.com
    port: 6379
    timeout: 2000ms
  
  jpa:
    hibernate:
      ddl-auto: update  # í”„ë¡œë•ì…˜ì—ì„œëŠ” validateë¡œ ë³€ê²½
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true
    show-sql: true
```

#### 3-3. Docker ì´ë¯¸ì§€ ë¹Œë“œ
```bash
# ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ (ì„ íƒì‚¬í•­)
docker-compose up -d

# í…ŒìŠ¤íŠ¸ API í˜¸ì¶œ
curl http://localhost:8080/api/health
# ì¶œë ¥: {"status":"UP","timestamp":"2024-..."}

# í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ ì¤‘ì§€
docker-compose down

# í”„ë¡œë•ì…˜ìš© Docker ì´ë¯¸ì§€ ë¹Œë“œ
docker build -t ticketing-app:latest .

# ë¹Œë“œ í™•ì¸
docker images | grep ticketing-app
# ì¶œë ¥ ì˜ˆì‹œ:
# ticketing-app   latest   1a2b3c4d5e6f   2 minutes ago   300MB
```

---

### 4.4 STEP 4: ECRì— ì´ë¯¸ì§€ í‘¸ì‹œ (3ë¶„)

#### 4-1. ECR ë¡œê·¸ì¸
```bash
# Terraform outputì—ì„œ ECR URL ê°€ì ¸ì˜¤ê¸°
ECR_URL=$(cat ../ecr_url.txt)
REGION="ap-northeast-2"

# ECR ë¡œê·¸ì¸
aws ecr get-login-password --region $REGION | \
  docker login --username AWS --password-stdin $ECR_URL

# ì¶œë ¥ ì˜ˆì‹œ:
# Login Succeeded
```

#### 4-2. Docker ì´ë¯¸ì§€ íƒœê¹… ë° í‘¸ì‹œ
```bash
# ì´ë¯¸ì§€ íƒœê¹…
docker tag ticketing-app:latest $ECR_URL:latest
docker tag ticketing-app:latest $ECR_URL:v1.0.0

# ECRì— í‘¸ì‹œ
docker push $ECR_URL:latest
docker push $ECR_URL:v1.0.0

# ì¶œë ¥ ì˜ˆì‹œ:
# The push refers to repository [123456789012.dkr.ecr.ap-northeast-2.amazonaws.com/ticketing-dev]
# latest: digest: sha256:abc123... size: 2828
# v1.0.0: digest: sha256:abc123... size: 2828
```

#### 4-3. ECRì—ì„œ ì´ë¯¸ì§€ í™•ì¸
```bash
# CLIë¡œ í™•ì¸
aws ecr describe-images \
  --repository-name ticketing-dev \
  --region ap-northeast-2

# AWS Consoleì—ì„œ í™•ì¸
# https://console.aws.amazon.com/ecr/repositories/ticketing-dev
```

---

### 4.5 STEP 5: EC2 ì¸ìŠ¤í„´ìŠ¤ì— ë°°í¬ (7ë¶„)

#### 5-1. Auto Scaling Group ì¸ìŠ¤í„´ìŠ¤ í™•ì¸
```bash
# Auto Scaling Group ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
ASG_NAME="ticketing-dev-asg"

# ì‹¤í–‰ ì¤‘ì¸ ì¸ìŠ¤í„´ìŠ¤ í™•ì¸
aws autoscaling describe-auto-scaling-groups \
  --auto-scaling-group-names $ASG_NAME \
  --query 'AutoScalingGroups[0].Instances[*].[InstanceId,LifecycleState,HealthStatus]' \
  --output table

# ì¶œë ¥ ì˜ˆì‹œ:
# --------------------------------
# |  i-0abc123  |  InService  |  Healthy  |
# |  i-0def456  |  InService  |  Healthy  |
# --------------------------------
```

#### 5-2. User Data ìŠ¤í¬ë¦½íŠ¸ ë™ì‘ í™•ì¸
```bash
# ì¸ìŠ¤í„´ìŠ¤ ID ê°€ì ¸ì˜¤ê¸°
INSTANCE_ID=$(aws autoscaling describe-auto-scaling-groups \
  --auto-scaling-group-names $ASG_NAME \
  --query 'AutoScalingGroups[0].Instances[0].InstanceId' \
  --output text)

# User Data ì‹¤í–‰ ë¡œê·¸ í™•ì¸
aws ssm send-command \
  --instance-ids $INSTANCE_ID \
  --document-name "AWS-RunShellScript" \
  --parameters 'commands=["tail -100 /var/log/user-data.log"]' \
  --output text

# ë˜ëŠ” SSHë¡œ ì ‘ì† (í‚¤ í˜ì–´ê°€ ìˆëŠ” ê²½ìš°)
ssh -i ~/.ssh/ticketing-keypair.pem ec2-user@<INSTANCE_PUBLIC_IP>
sudo tail -f /var/log/user-data.log
```

#### 5-3. ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ëŒ€ê¸°
```bash
# User Data ìŠ¤í¬ë¦½íŠ¸ê°€ ë‹¤ìŒ ì‘ì—…ì„ ìë™ ìˆ˜í–‰:
# 1. Docker ì„¤ì¹˜
# 2. ECR ë¡œê·¸ì¸
# 3. Docker ì´ë¯¸ì§€ Pull
# 4. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ (í¬íŠ¸ 8080)
# 5. Health Check ëŒ€ê¸°

# ì•½ 5-7ë¶„ ì†Œìš”
echo "ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ì¤‘... (5-7ë¶„ ì†Œìš”)"
sleep 420  # 7ë¶„ ëŒ€ê¸°
```

---

### 4.6 STEP 6: ALB Target Health í™•ì¸

#### 6-1. Target Group ìƒíƒœ í™•ì¸
```bash
# Target Group ARN ê°€ì ¸ì˜¤ê¸°
TG_ARN=$(aws elbv2 describe-target-groups \
  --names ticketing-dev-tg \
  --query 'TargetGroups[0].TargetGroupArn' \
  --output text)

# Target Health í™•ì¸
aws elbv2 describe-target-health \
  --target-group-arn $TG_ARN \
  --output table

# ì¶œë ¥ ì˜ˆì‹œ:
# --------------------------------
# |  TargetId     |  TargetHealth  |
# |  i-0abc123    |  healthy       |
# |  i-0def456    |  healthy       |
# --------------------------------
```

#### 6-2. AWS Consoleì—ì„œ í™•ì¸
1. **EC2 > Target Groups**: https://console.aws.amazon.com/ec2/v2/home#TargetGroups
2. **ticketing-dev-tg** í´ë¦­
3. **Targets** íƒ­ì—ì„œ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ê°€ "healthy" ìƒíƒœì¸ì§€ í™•ì¸

---

## 5. í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

### 5.1 API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸

#### 5-1. ALB DNS ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸°
```bash
ALB_DNS=$(cat ../alb_dns.txt)
echo "ALB DNS: $ALB_DNS"
# ì˜ˆì‹œ: ticketing-dev-alb-1234567890.ap-northeast-2.elb.amazonaws.com
```

#### 5-2. Health Check
```bash
curl http://$ALB_DNS/api/health

# ì˜ˆìƒ ì‘ë‹µ:
# {
#   "status": "UP",
#   "timestamp": "2024-10-27T10:30:00Z",
#   "database": "connected",
#   "redis": "connected"
# }
```

#### 5-3. ì´ë²¤íŠ¸ ìƒì„±
```bash
curl -X POST http://$ALB_DNS/api/events \
  -H "Content-Type: application/json" \
  -d '{
    "eventName": "IU ì½˜ì„œíŠ¸",
    "totalSeats": 10000,
    "eventDate": "2024-12-31T19:00:00"
  }'

# ì˜ˆìƒ ì‘ë‹µ:
# {
#   "success": true,
#   "message": "Event created successfully",
#   "data": {
#     "eventId": 1,
#     "eventName": "IU ì½˜ì„œíŠ¸",
#     "totalSeats": 10000,
#     "availableSeats": 10000,
#     "eventDate": "2024-12-31T19:00:00"
#   }
# }
```

#### 5-4. ì´ë²¤íŠ¸ ëª©ë¡ ì¡°íšŒ
```bash
curl http://$ALB_DNS/api/events

# ì˜ˆìƒ ì‘ë‹µ:
# {
#   "success": true,
#   "data": [
#     {
#       "eventId": 1,
#       "eventName": "IU ì½˜ì„œíŠ¸",
#       "availableSeats": 10000,
#       "eventDate": "2024-12-31T19:00:00"
#     }
#   ]
# }
```

#### 5-5. í‹°ì¼“ ì˜ˆë§¤ (ë‹¨ê±´)
```bash
curl -X POST http://$ALB_DNS/api/reservations \
  -H "Content-Type: application/json" \
  -d '{
    "eventId": 1,
    "userId": "user123",
    "quantity": 2
  }'

# ì˜ˆìƒ ì‘ë‹µ:
# {
#   "success": true,
#   "message": "Reservation successful",
#   "data": {
#     "reservationId": "550e8400-e29b-41d4-a716-446655440000",
#     "eventId": 1,
#     "userId": "user123",
#     "quantity": 2,
#     "reservationTime": "2024-10-27T10:35:00"
#   }
# }
```

#### 5-6. ì˜ˆë§¤ ë‚´ì—­ ì¡°íšŒ
```bash
curl "http://$ALB_DNS/api/reservations/user/user123"

# ì˜ˆìƒ ì‘ë‹µ:
# {
#   "success": true,
#   "data": [
#     {
#       "reservationId": "550e8400-e29b-41d4-a716-446655440000",
#       "eventName": "IU ì½˜ì„œíŠ¸",
#       "quantity": 2,
#       "reservationTime": "2024-10-27T10:35:00"
#     }
#   ]
# }
```

### 5.2 ë™ì‹œì„± ì œì–´ í…ŒìŠ¤íŠ¸

#### 5-2-1. Apache Benchë¡œ ê°„ë‹¨ í…ŒìŠ¤íŠ¸
```bash
# Apache Bench ì„¤ì¹˜ (ì—†ëŠ” ê²½ìš°)
# macOS: brew install apache2 (httpd í¬í•¨)
# Linux: sudo apt install apache2-utils

# ë™ì‹œ 100ëª…ì´ í‹°ì¼“ ì˜ˆë§¤ ì‹œë„
ab -n 100 -c 100 -p reservation.json -T application/json \
  http://$ALB_DNS/api/reservations

# reservation.json íŒŒì¼ ë‚´ìš©:
# {
#   "eventId": 1,
#   "userId": "loadtest",
#   "quantity": 1
# }

# ê²°ê³¼ ë¶„ì„:
# - ì„±ê³µ ìš”ì²­: ì¢Œì„ ìˆ˜ë§Œí¼ë§Œ ì„±ê³µí•´ì•¼ í•¨
# - ì‹¤íŒ¨ ìš”ì²­: ì¬ê³  ë¶€ì¡± ì—ëŸ¬
# - ì¤‘ë³µ ì˜ˆë§¤: 0ê±´ (Redis ë½ ë•ë¶„)
```

#### 5-2-2. Python ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì‹œì„± í…ŒìŠ¤íŠ¸
```python
# concurrent_test.py
import requests
import concurrent.futures
import time

ALB_DNS = "your-alb-dns.amazonaws.com"  # ì‹¤ì œ ALB DNSë¡œ ë³€ê²½
BASE_URL = f"http://{ALB_DNS}/api"

def reserve_ticket(user_id):
    """í‹°ì¼“ ì˜ˆë§¤ ì‹œë„"""
    payload = {
        "eventId": 1,
        "userId": f"user{user_id}",
        "quantity": 1
    }
    try:
        response = requests.post(f"{BASE_URL}/reservations", json=payload, timeout=10)
        return response.status_code, response.json()
    except Exception as e:
        return None, str(e)

def main():
    # ë™ì‹œ 1000ëª…ì´ í‹°ì¼“ ì˜ˆë§¤ ì‹œë„
    num_users = 1000
    
    print(f"ğŸš€ ë™ì‹œì„± í…ŒìŠ¤íŠ¸ ì‹œì‘: {num_users}ëª…ì˜ ì‚¬ìš©ì")
    start_time = time.time()
    
    with concurrent.futures.ThreadPoolExecutor(max_workers=100) as executor:
        futures = [executor.submit(reserve_ticket, i) for i in range(num_users)]
        results = [f.result() for f in concurrent.futures.as_completed(futures)]
    
    end_time = time.time()
    
    # ê²°ê³¼ ë¶„ì„
    success_count = sum(1 for status, _ in results if status == 200)
    fail_count = len(results) - success_count
    
    print(f"âœ… ì„±ê³µ: {success_count}ê±´")
    print(f"âŒ ì‹¤íŒ¨: {fail_count}ê±´")
    print(f"â±ï¸  ì†Œìš” ì‹œê°„: {end_time - start_time:.2f}ì´ˆ")
    print(f"ğŸ”’ ì¤‘ë³µ ì˜ˆë§¤: 0ê±´ (Redis ë¶„ì‚° ë½ìœ¼ë¡œ ë°©ì§€)")

if __name__ == "__main__":
    main()
```

```bash
# Python ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
python3 concurrent_test.py
```

### 5.3 ìºì‹± ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

```bash
# 1. ì²« ë²ˆì§¸ ìš”ì²­ (DB ì¡°íšŒ, ìºì‹œ ì €ì¥)
time curl http://$ALB_DNS/api/events/1
# ì˜ˆìƒ ì‘ë‹µ ì‹œê°„: ~200ms

# 2. ë‘ ë²ˆì§¸ ìš”ì²­ (ìºì‹œì—ì„œ ì¡°íšŒ)
time curl http://$ALB_DNS/api/events/1
# ì˜ˆìƒ ì‘ë‹µ ì‹œê°„: ~10ms (20ë°° ë¹ ë¦„!)

# 3. ìºì‹œ í™•ì¸ (Redis CLI ì ‘ì† í•„ìš”)
# Redis ì—”ë“œí¬ì¸íŠ¸ë¡œ ì ‘ì† í›„
# GET event:1
```

---

## 6. ëª¨ë‹ˆí„°ë§ ì„¤ì •

### 6.1 CloudWatch ëŒ€ì‹œë³´ë“œ í™•ì¸

#### 6-1-1. AWS Consoleì—ì„œ í™•ì¸
1. **CloudWatch Dashboard**: https://console.aws.amazon.com/cloudwatch/
2. **Dashboards > ticketing-dev-dashboard** í´ë¦­
3. ì£¼ìš” ë©”íŠ¸ë¦­ í™•ì¸:
   - âœ… ALB Target Health (Healthy Targets)
   - âœ… EC2 CPU Utilization
   - âœ… RDS Database Connections
   - âœ… ElastiCache Redis Memory
   - âœ… Auto Scaling Group Size

#### 6-1-2. CLIë¡œ ë©”íŠ¸ë¦­ ì¡°íšŒ
```bash
# ALB Request Count (ìµœê·¼ 1ì‹œê°„)
aws cloudwatch get-metric-statistics \
  --namespace AWS/ApplicationELB \
  --metric-name RequestCount \
  --dimensions Name=LoadBalancer,Value=app/ticketing-dev-alb/... \
  --start-time $(date -u -d '1 hour ago' +%Y-%m-%dT%H:%M:%S) \
  --end-time $(date -u +%Y-%m-%dT%H:%M:%S) \
  --period 300 \
  --statistics Sum

# RDS CPU Utilization
aws cloudwatch get-metric-statistics \
  --namespace AWS/RDS \
  --metric-name CPUUtilization \
  --dimensions Name=DBClusterIdentifier,Value=ticketing-dev-aurora-cluster \
  --start-time $(date -u -d '1 hour ago' +%Y-%m-%dT%H:%M:%S) \
  --end-time $(date -u +%Y-%m-%dT%H:%M:%S) \
  --period 300 \
  --statistics Average
```

### 6.2 SNS ì•ŒëŒ ì„¤ì • í™•ì¸

#### 6-2-1. ì´ë©”ì¼ êµ¬ë… í™•ì¸
```bash
# SNS Topic ARN ê°€ì ¸ì˜¤ê¸°
TOPIC_ARN=$(aws sns list-topics \
  --query 'Topics[?contains(TopicArn, `ticketing-dev-alerts`)].TopicArn' \
  --output text)

# êµ¬ë… ëª©ë¡ í™•ì¸
aws sns list-subscriptions-by-topic --topic-arn $TOPIC_ARN

# ì¶œë ¥ ì˜ˆì‹œ:
# {
#   "Subscriptions": [
#     {
#       "SubscriptionArn": "arn:aws:sns:ap-northeast-2:123456789012:ticketing-dev-alerts:...",
#       "Endpoint": "your-email@example.com",
#       "Protocol": "email",
#       "SubscriptionStatus": "Confirmed"
#     }
#   ]
# }
```

#### 6-2-2. ì´ë©”ì¼ êµ¬ë… ìŠ¹ì¸
**ì´ë©”ì¼ í™•ì¸ì´ ì•ˆ ëœ ê²½ìš°:**
1. AWSì—ì„œ ë³´ë‚¸ "AWS Notification - Subscription Confirmation" ì´ë©”ì¼ í™•ì¸
2. "Confirm subscription" ë§í¬ í´ë¦­
3. êµ¬ë… ìƒíƒœê°€ "Confirmed"ë¡œ ë³€ê²½

#### 6-2-3. ì•ŒëŒ í…ŒìŠ¤íŠ¸
```bash
# CPU ì•ŒëŒ ìƒíƒœ í™•ì¸
aws cloudwatch describe-alarms \
  --alarm-names "ticketing-dev-high-cpu" \
  --output table

# í…ŒìŠ¤íŠ¸ ì•ŒëŒ ë°œì†¡
aws cloudwatch set-alarm-state \
  --alarm-name "ticketing-dev-high-cpu" \
  --state-value ALARM \
  --state-reason "Manual test"

# ì´ë©”ì¼ë¡œ ì•ŒëŒ ìˆ˜ì‹  í™•ì¸
# ì œëª©: "ALARM: ticketing-dev-high-cpu in ap-northeast-2"
```

### 6.3 ë¡œê·¸ í™•ì¸

#### 6-3-1. CloudWatch Logs
```bash
# ë¡œê·¸ ê·¸ë£¹ í™•ì¸
aws logs describe-log-groups \
  --log-group-name-prefix "/aws/ticketing-dev"

# ìµœê·¼ ë¡œê·¸ ìŠ¤íŠ¸ë¦¼ ì¡°íšŒ
aws logs describe-log-streams \
  --log-group-name "/aws/ec2/ticketing-dev" \
  --order-by LastEventTime \
  --descending \
  --max-items 5

# ë¡œê·¸ ë‚´ìš© í™•ì¸
aws logs tail /aws/ec2/ticketing-dev --follow
```

#### 6-3-2. Application ë¡œê·¸ (EC2 ì¸ìŠ¤í„´ìŠ¤)
```bash
# SSH ì ‘ì† í›„
ssh -i ~/.ssh/ticketing-keypair.pem ec2-user@<INSTANCE_IP>

# Docker ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸
sudo docker logs ticketing-app --tail 100 -f

# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ íŒ¨í„´
# 2024-10-27 10:30:15 INFO  [http-nio-8080-exec-1] ReservationService : Attempting reservation for user123
# 2024-10-27 10:30:15 DEBUG [http-nio-8080-exec-1] RedisLockService : Acquired lock for event:1
# 2024-10-27 10:30:15 INFO  [http-nio-8080-exec-1] ReservationService : Reservation successful: 2 seats
# 2024-10-27 10:30:15 DEBUG [http-nio-8080-exec-1] RedisLockService : Released lock for event:1
```

---

## 7. ë¬¸ì œ í•´ê²° (Troubleshooting)

### 7.1 Terraform ê´€ë ¨ ë¬¸ì œ

#### âŒ ë¬¸ì œ: "Error: creating RDS Cluster: DBClusterParameterGroup not found"
**ì›ì¸**: RDS Parameter Groupì´ ë¨¼ì € ìƒì„±ë˜ì§€ ì•ŠìŒ

**í•´ê²°ì±…**:
```bash
# ì˜ì¡´ì„± ìˆœì„œ í™•ì¸
terraform graph | dot -Tpng > graph.png

# ë‹¤ì‹œ ë°°í¬
terraform apply -auto-approve
```

#### âŒ ë¬¸ì œ: "Error: creating Auto Scaling Group: InsufficientInstanceCapacity"
**ì›ì¸**: EC2 ì¸ìŠ¤í„´ìŠ¤ ìš©ëŸ‰ ë¶€ì¡± (íŠ¹ì • AZ)

**í•´ê²°ì±…**:
```bash
# terraform.tfvars ìˆ˜ì •
# ë‹¤ë¥¸ ê°€ìš© ì˜ì—­ ì‚¬ìš©
availability_zones = ["ap-northeast-2a", "ap-northeast-2b"]  # 2c ëŒ€ì‹  2b

terraform apply -auto-approve
```

#### âŒ ë¬¸ì œ: "Error: timeout waiting for Load Balancer to be active"
**ì›ì¸**: ALB ìƒì„± ì‹œê°„ ì´ˆê³¼ (ë“œë¬¼ê²Œ ë°œìƒ)

**í•´ê²°ì±…**:
```bash
# AWS Consoleì—ì„œ ALB ìƒíƒœ ìˆ˜ë™ í™•ì¸
# ìƒíƒœê°€ "active"ë©´ Terraform stateë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë™ê¸°í™”
terraform refresh
terraform apply -auto-approve
```

### 7.2 ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ë¬¸ì œ

#### âŒ ë¬¸ì œ: Target Groupì—ì„œ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ê°€ "unhealthy"
**ì›ì¸**: ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í¬íŠ¸ 8080ì—ì„œ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

**í•´ê²°ì±… 1: User Data ë¡œê·¸ í™•ì¸**
```bash
# SSH ì ‘ì†
ssh -i ~/.ssh/ticketing-keypair.pem ec2-user@<INSTANCE_IP>

# User Data ë¡œê·¸ í™•ì¸
sudo tail -100 /var/log/user-data.log

# ì¼ë°˜ì ì¸ ì˜¤ë¥˜:
# - ECR ë¡œê·¸ì¸ ì‹¤íŒ¨ â†’ IAM ì—­í•  ê¶Œí•œ í™•ì¸
# - Docker ì´ë¯¸ì§€ Pull ì‹¤íŒ¨ â†’ ECR ì´ë¯¸ì§€ ì¡´ì¬ í™•ì¸
# - ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹¤íŒ¨ â†’ í™˜ê²½ ë³€ìˆ˜ í™•ì¸
```

**í•´ê²°ì±… 2: ìˆ˜ë™ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘**
```bash
# Docker ì»¨í…Œì´ë„ˆ í™•ì¸
sudo docker ps -a

# ì»¨í…Œì´ë„ˆê°€ ì—†ìœ¼ë©´ ìˆ˜ë™ ì‹¤í–‰
sudo docker run -d \
  --name ticketing-app \
  -p 8080:8080 \
  -e SPRING_DATASOURCE_URL="jdbc:mysql://your-rds-endpoint:3306/ticketing" \
  -e SPRING_DATASOURCE_USERNAME="admin" \
  -e SPRING_DATASOURCE_PASSWORD="YourPassword" \
  -e SPRING_REDIS_HOST="your-redis-endpoint" \
  -e SPRING_REDIS_PORT="6379" \
  <ECR_URL>:latest

# ë¡œê·¸ í™•ì¸
sudo docker logs ticketing-app -f
```

#### âŒ ë¬¸ì œ: "Connection refused" ì˜¤ë¥˜ (Redis ë˜ëŠ” RDS)
**ì›ì¸**: Security Group ì„¤ì • ë¬¸ì œ

**í•´ê²°ì±…**:
```bash
# Security Group ê·œì¹™ í™•ì¸
aws ec2 describe-security-groups \
  --filters "Name=tag:Name,Values=ticketing-dev-*" \
  --query 'SecurityGroups[*].[GroupName,IpPermissions]'

# RDS Security Groupì— EC2ì—ì„œ 3306 í¬íŠ¸ ì ‘ê·¼ í—ˆìš© í™•ì¸
# Redis Security Groupì— EC2ì—ì„œ 6379 í¬íŠ¸ ì ‘ê·¼ í—ˆìš© í™•ì¸

# Terraform ì½”ë“œ í™•ì¸ ë° ì¬ë°°í¬
cd terraform-ticketing
terraform apply -auto-approve
```

### 7.3 ì„±ëŠ¥ ë¬¸ì œ

#### âŒ ë¬¸ì œ: ì‘ë‹µ ì†ë„ê°€ ëŠë¦¼ (500ms ì´ìƒ)
**ì›ì¸**: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í’€ ë¶€ì¡± ë˜ëŠ” ìºì‹œ ë¯¸ì ì¤‘

**í•´ê²°ì±…**:
```yaml
# application.yml ìˆ˜ì •
spring:
  datasource:
    hikari:
      maximum-pool-size: 20  # ê¸°ë³¸ 10 â†’ 20ìœ¼ë¡œ ì¦ê°€
      minimum-idle: 5
      connection-timeout: 30000
  
  redis:
    lettuce:
      pool:
        max-active: 20  # ê¸°ë³¸ 8 â†’ 20ìœ¼ë¡œ ì¦ê°€
        max-idle: 10
        min-idle: 5
```

#### âŒ ë¬¸ì œ: Auto Scalingì´ ì‘ë™í•˜ì§€ ì•ŠìŒ
**ì›ì¸**: CloudWatch ì•ŒëŒ ì„ê³„ê°’ì´ ë„ˆë¬´ ë†’ìŒ

**í•´ê²°ì±…**:
```bash
# terraform.tfvars ìˆ˜ì •
auto_scaling_cpu_target = 50  # 70 â†’ 50ìœ¼ë¡œ ë‚®ì¶¤

# Terraform ì¬ë°°í¬
terraform apply -auto-approve

# ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¡œ Auto Scaling ê²€ì¦
ab -n 10000 -c 100 http://$ALB_DNS/api/events
```

### 7.4 ë¹„ìš© ì´ˆê³¼ ë¬¸ì œ

#### âŒ ë¬¸ì œ: ì˜ˆìƒë³´ë‹¤ ë†’ì€ AWS ë¹„ìš©
**ì›ì¸**: NAT Gateway, RDS Aurora ì§€ì† ì‹¤í–‰

**í•´ê²°ì±… 1: ê°œë°œ í™˜ê²½ ë¹„ìš© ì ˆê°**
```bash
# terraform.tfvars ìˆ˜ì • (Dev í™˜ê²½)
db_instance_class = "db.t3.medium"       # db.r5.large â†’ db.t3.medium
redis_node_type   = "cache.t3.micro"     # cache.r5.large â†’ cache.t3.micro
enable_nat_gateway = false               # NAT Gateway ë¹„í™œì„±í™” (Public Subnetë§Œ ì‚¬ìš©)

terraform apply -auto-approve
```

**í•´ê²°ì±… 2: ì‚¬ìš©í•˜ì§€ ì•Šì„ ë•Œ ì¤‘ì§€**
```bash
# RDS Aurora Cluster ì¤‘ì§€ (ìµœëŒ€ 7ì¼)
aws rds stop-db-cluster --db-cluster-identifier ticketing-dev-aurora-cluster

# Auto Scaling ìµœì†Œê°’ì„ 0ìœ¼ë¡œ ì„¤ì •
aws autoscaling update-auto-scaling-group \
  --auto-scaling-group-name ticketing-dev-asg \
  --min-size 0 \
  --desired-capacity 0

# ë‹¤ì‹œ ì‹œì‘í•  ë•Œ
aws rds start-db-cluster --db-cluster-identifier ticketing-dev-aurora-cluster
aws autoscaling update-auto-scaling-group \
  --auto-scaling-group-name ticketing-dev-asg \
  --min-size 2 \
  --desired-capacity 2
```

---

## 8. í”„ë¡œì íŠ¸ ì‚­ì œ

### 8.1 ì „ì²´ ì¸í”„ë¼ ì‚­ì œ

#### âš ï¸ ì£¼ì˜ì‚¬í•­
- ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤
- RDS ìŠ¤ëƒ…ìƒ·ì„ ë¨¼ì € ìƒì„±í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤
- S3 ë²„í‚·ì— ë°ì´í„°ê°€ ìˆìœ¼ë©´ ìˆ˜ë™ ì‚­ì œ í•„ìš”

#### 8-1. RDS ìŠ¤ëƒ…ìƒ· ìƒì„± (ì„ íƒ)
```bash
aws rds create-db-cluster-snapshot \
  --db-cluster-identifier ticketing-dev-aurora-cluster \
  --db-cluster-snapshot-identifier ticketing-dev-snapshot-$(date +%Y%m%d)

# ìŠ¤ëƒ…ìƒ· ìƒì„± ëŒ€ê¸° (5-10ë¶„)
aws rds wait db-cluster-snapshot-available \
  --db-cluster-snapshot-identifier ticketing-dev-snapshot-$(date +%Y%m%d)
```

#### 8-2. Terraform ì‚­ì œ ì‹¤í–‰
```bash
cd terraform-ticketing

# ë°©ë²• 1: ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš© (ê¶Œì¥)
chmod +x scripts/destroy.sh
./scripts/destroy.sh

# ë°©ë²• 2: ìˆ˜ë™ ì‹¤í–‰
terraform destroy

# í™•ì¸ ë©”ì‹œì§€ì—ì„œ "yes" ì…ë ¥
# Do you really want to destroy all resources? yes

# ì‚­ì œ ì§„í–‰ ì¤‘... (ì•½ 10-15ë¶„ ì†Œìš”)
```

#### 8-3. ìˆ˜ë™ ì •ë¦¬ (í•„ìš” ì‹œ)
```bash
# S3 ë²„í‚· ê°•ì œ ì‚­ì œ (ë²„í‚·ì— íŒŒì¼ì´ ìˆëŠ” ê²½ìš°)
aws s3 rm s3://ticketing-dev-bucket --recursive
aws s3 rb s3://ticketing-dev-bucket --force

# ECR ì´ë¯¸ì§€ ì‚­ì œ
aws ecr batch-delete-image \
  --repository-name ticketing-dev \
  --image-ids imageTag=latest imageTag=v1.0.0

# ECR ë¦¬í¬ì§€í† ë¦¬ ì‚­ì œ
aws ecr delete-repository \
  --repository-name ticketing-dev \
  --force

# CloudWatch Log Group ì‚­ì œ
aws logs delete-log-group --log-group-name /aws/ec2/ticketing-dev
```

#### 8-4. ì‚­ì œ í™•ì¸
```bash
# VPC í™•ì¸ (ëª¨ë‘ ì‚­ì œë˜ì–´ì•¼ í•¨)
aws ec2 describe-vpcs \
  --filters "Name=tag:Name,Values=ticketing-dev-vpc"

# RDS í™•ì¸
aws rds describe-db-clusters \
  --db-cluster-identifier ticketing-dev-aurora-cluster

# ì¶œë ¥: DBClusterNotFoundFault (ì •ìƒ)
```

---

## 9. ì¶”ê°€ ìë£Œ ë° ì°¸ê³  ë§í¬

### 9.1 ê³µì‹ ë¬¸ì„œ
- **Terraform AWS Provider**: https://registry.terraform.io/providers/hashicorp/aws/latest/docs
- **AWS RDS Aurora**: https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/
- **AWS ElastiCache Redis**: https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/
- **Spring Boot**: https://spring.io/projects/spring-boot
- **Spring Data Redis**: https://spring.io/projects/spring-data-redis

### 9.2 í”„ë¡œì íŠ¸ íŒŒì¼ ìœ„ì¹˜
- **AI Drive ê²½ë¡œ**: `/Terraformì„ ì´ìš©í•œ ê³ ê°€ìš©ì„± í‹°ì¼“íŒ… í”„ë¡œì íŠ¸/`
- **Terraform ì½”ë“œ**: `terraform-ticketing/`
- **Spring Boot ì•±**: `ticketing-app/`
- **ì••ì¶• íŒŒì¼**:
  - `terraform-ticketing-platform.tar.gz` (19.9KB)
  - `ticketing-app.tar.gz` (11.1KB)

### 9.3 GitHub ìŠ¤í¬ë¦°ìƒ·
1. **architecture-diagram.jpeg** (121.5KB)
   - AWS 3-Tier ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨
   
2. **api-documentation.jpeg** (534.2KB)
   - REST API 7ê°œ ì—”ë“œí¬ì¸íŠ¸ ë¬¸ì„œ
   
3. **cloudwatch-dashboard.jpeg** (435.4KB)
   - CloudWatch ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

### 9.4 ì˜ˆìƒ ë¹„ìš© ìƒì„¸
```
ì›”ë³„ ì˜ˆìƒ ë¹„ìš© (Dev í™˜ê²½, ap-northeast-2)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
VPC & Networking
  - NAT Gateway (2ê°œ):          $64.80
  - Data Transfer:               $5.00
  
Compute
  - EC2 t3.medium (í‰ê·  4ëŒ€):    $120.96
  - ALB:                         $22.50
  
Database
  - RDS Aurora (t3.medium x2):   $109.44
  
Cache
  - ElastiCache (t3.micro):      $12.41
  
Storage
  - S3:                          $5.00
  - EBS (GP3, 400GB):            $32.00
  
Monitoring & Messaging
  - CloudWatch:                  $10.00
  - SNS/SQS:                     $2.00
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
í•©ê³„:                            $384.11/ì›”

â€» ì‹¤ì œ ë¹„ìš©ì€ íŠ¸ë˜í”½ê³¼ ì‚¬ìš©ëŸ‰ì— ë”°ë¼ ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
â€» NAT Gatewayë¥¼ ë¹„í™œì„±í™”í•˜ë©´ ì•½ $64.80 ì ˆê° ê°€ëŠ¥
```

---

## 10. ë§ˆë¬´ë¦¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

í”„ë¡œì íŠ¸ë¥¼ ì™„ë£Œí•œ í›„ ë‹¤ìŒ í•­ëª©ì„ í™•ì¸í•˜ì„¸ìš”:

### ì¸í”„ë¼ ë°°í¬
- [ ] Terraformìœ¼ë¡œ ëª¨ë“  AWS ë¦¬ì†ŒìŠ¤ ìƒì„± ì™„ë£Œ
- [ ] VPC, Subnets (Public x2, Private x2, Database x2) ìƒì„±
- [ ] RDS Aurora Cluster (Writer + Reader) ì‹¤í–‰ ì¤‘
- [ ] ElastiCache Redis Cluster ì‹¤í–‰ ì¤‘
- [ ] ALB ìƒíƒœ "active", Target Group "healthy"
- [ ] Auto Scaling Group (2~20ëŒ€) ì •ìƒ ì‘ë™

### ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
- [ ] Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ ì™„ë£Œ
- [ ] Docker ì´ë¯¸ì§€ ECRì— Push ì™„ë£Œ
- [ ] EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì¤‘
- [ ] Health Check ì—”ë“œí¬ì¸íŠ¸ ì‘ë‹µ í™•ì¸
- [ ] API í…ŒìŠ¤íŠ¸ (ì´ë²¤íŠ¸ ìƒì„±, ì¡°íšŒ, ì˜ˆë§¤) ì„±ê³µ

### ê¸°ëŠ¥ ê²€ì¦
- [ ] í‹°ì¼“ ì˜ˆë§¤ ë™ì‹œì„± ì œì–´ (Redis ë½) ì •ìƒ ì‘ë™
- [ ] ìºì‹± ì„±ëŠ¥ (10ms ì´ë‚´ ì‘ë‹µ) í™•ì¸
- [ ] ë¶€í•˜ í…ŒìŠ¤íŠ¸ (1,000+ ë™ì‹œ ì ‘ì†) í†µê³¼
- [ ] Auto Scaling (CPU > 70%) ìë™ í™•ì¥ í™•ì¸

### ëª¨ë‹ˆí„°ë§
- [ ] CloudWatch Dashboard ì •ìƒ í‘œì‹œ
- [ ] SNS ì´ë©”ì¼ ì•ŒëŒ êµ¬ë… í™•ì¸
- [ ] CloudWatch Logs ì •ìƒ ìˆ˜ì§‘
- [ ] ì•ŒëŒ í…ŒìŠ¤íŠ¸ (CPU, Target Health) ì„±ê³µ

### ë¬¸ì„œí™”
- [ ] í”„ë¡œì íŠ¸ README ì‘ì„± ì™„ë£Œ
- [ ] API ë¬¸ì„œ (ìŠ¤í¬ë¦°ìƒ·) ì¤€ë¹„
- [ ] ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±
- [ ] í¬íŠ¸í´ë¦¬ì˜¤ ì •ë¦¬ (GitHub/Notion)

---

**ì´ë©”ì¼**: rlagudfo1223@gmail.com
**GitHub**: https://github.com/qkrtpdlr/terraform-ticketing-platform  
**í”„ë¡œì íŠ¸ ê¸°ê°„**: 2024.10.01 ~ 2024.10.27
